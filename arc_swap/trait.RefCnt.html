<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A trait describing smart reference counted pointers."><title>RefCnt in arc_swap - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="arc_swap" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0 (f6e511eec 2024-10-15)" data-channel="1.82.0" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../arc_swap/index.html">arc_<wbr>swap</a><span class="version">1.7.1</span></h2></div><h2 class="location"><a href="#">RefCnt</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.Base">Base</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.as_ptr">as_ptr</a></li><li><a href="#tymethod.from_ptr">from_ptr</a></li><li><a href="#tymethod.into_ptr">into_ptr</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.dec">dec</a></li><li><a href="#method.inc">inc</a></li></ul><h3><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul class="block"><li><a href="#impl-RefCnt-for-Arc%3CT%3E">Arc&#60;T&#62;</a></li><li><a href="#impl-RefCnt-for-Option%3CT%3E">Option&#60;T&#62;</a></li><li><a href="#impl-RefCnt-for-Rc%3CT%3E">Rc&#60;T&#62;</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In crate arc_<wbr>swap</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="index.html">arc_swap</a>::<wbr><a class="trait" href="#">RefCnt</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/arc_swap/ref_cnt.rs.html#39-89">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub unsafe trait RefCnt: <a class="trait" href="https://doc.rust-lang.org/1.82.0/core/clone/trait.Clone.html" title="trait core::clone::Clone">Clone</a> {
    type <a href="#associatedtype.Base" class="associatedtype">Base</a>;

    // Required methods
    fn <a href="#tymethod.into_ptr" class="fn">into_ptr</a>(me: Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.as_ptr" class="fn">as_ptr</a>(me: &amp;Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.from_ptr" class="fn">from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) -&gt; Self;

    // Provided methods
    fn <a href="#method.inc" class="fn">inc</a>(me: &amp;Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a> { ... }
<span class="item-spacer"></span>    unsafe fn <a href="#method.dec" class="fn">dec</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A trait describing smart reference counted pointers.</p>
<p>Note that in a way <a href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option"><code>Option&lt;Arc&lt;T&gt;&gt;</code></a> is also a smart reference counted pointer, just
one that can hold NULL.</p>
<p>The trait is unsafe, because a wrong implementation will break the <a href="struct.ArcSwapAny.html" title="struct arc_swap::ArcSwapAny">ArcSwapAny</a>
implementation and lead to UB.</p>
<p>This is not actually expected for downstream crate to implement, this is just means to reuse
code for <a href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a> and <a href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option"><code>Option&lt;Arc&gt;</code></a> variants. However, it is theoretically possible (if
you have your own <a href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a> implementation).</p>
<p>It is also implemented for <a href="https://doc.rust-lang.org/1.82.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>, but that is not considered very useful (because the
<a href="struct.ArcSwapAny.html" title="struct arc_swap::ArcSwapAny">ArcSwapAny</a> is not <code>Send</code> or <code>Sync</code>, therefore there’s very little advantage for it to be
atomic).</p>
<h2 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h2>
<p>Aside from the obvious properties (like that incrementing and decrementing a reference count
cancel each out and that having less references tracked than how many things actually point to
the value is fine as long as the count doesn’t drop to 0), it also must satisfy that if two
pointers have the same value, they point to the same object. This is specifically not true for
ZSTs, but it is true for <code>Arc</code>s of ZSTs, because they have the reference counts just after the
value. It would be fine to point to a type-erased version of the same object, though (if one
could use this trait with unsized types in the first place).</p>
<p>Furthermore, the type should be Pin (eg. if the type is cloned or moved, it should still
point/deref to the same place in memory).</p>
</div></details><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedtype.Base" class="method"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#41">source</a><h4 class="code-header">type <a href="#associatedtype.Base" class="associatedtype">Base</a></h4></section></summary><div class="docblock"><p>The base type the pointer points to.</p>
</div></details></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.into_ptr" class="method"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#50">source</a><h4 class="code-header">fn <a href="#tymethod.into_ptr" class="fn">into_ptr</a>(me: Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></h4></section></summary><div class="docblock"><p>Converts the smart pointer into a raw pointer, without affecting the reference count.</p>
<p>This can be seen as kind of freezing the pointer ‒ it’ll be later converted back using
<a href="#method.from_ptr"><code>from_ptr</code></a>.</p>
<p>The pointer must point to the value stored (and the value must be the same as one returned
by <a href="#method.as_ptr"><code>as_ptr</code></a>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.as_ptr" class="method"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#55">source</a><h4 class="code-header">fn <a href="#tymethod.as_ptr" class="fn">as_ptr</a>(me: &amp;Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></h4></section></summary><div class="docblock"><p>Provides a view into the smart pointer as a raw pointer.</p>
<p>This must not affect the reference count ‒ the pointer is only borrowed.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.from_ptr" class="method"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#68">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.from_ptr" class="fn">from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) -&gt; Self</h4></section></summary><div class="docblock"><p>Converts a raw pointer back into the smart pointer, without affecting the reference count.</p>
<p>This is only called on values previously returned by <a href="#method.into_ptr"><code>into_ptr</code></a>.
However, it is not guaranteed to be 1:1 relation ‒ <code>from_ptr</code> may be called more times than
<code>into_ptr</code> temporarily provided the reference count never drops under 1 during that time
(the implementation sometimes owes a reference). These extra pointers will either be
converted back using <code>into_ptr</code> or forgotten.</p>
<h5 id="safety-1"><a class="doc-anchor" href="#safety-1">§</a>Safety</h5>
<p>This must not be called by code outside of this crate.</p>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.inc" class="method"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#73-75">source</a><h4 class="code-header">fn <a href="#method.inc" class="fn">inc</a>(me: &amp;Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></h4></section></summary><div class="docblock"><p>Increments the reference count by one.</p>
<p>Return the pointer to the inner thing as a side effect.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.dec" class="method"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#86-88">source</a><h4 class="code-header">unsafe fn <a href="#method.dec" class="fn">dec</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>)</h4></section></summary><div class="docblock"><p>Decrements the reference count by one.</p>
<p>Note this is called on a raw pointer (one previously returned by
<a href="#method.into_ptr"><code>into_ptr</code></a>. This may lead to dropping of the reference count to 0 and
destruction of the internal pointer.</p>
<h5 id="safety-2"><a class="doc-anchor" href="#safety-2">§</a>Safety</h5>
<p>This must not be called by code outside of this crate.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/1.82.0/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="foreign-impls" class="section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor">§</a></h2><details class="toggle implementors-toggle"><summary><section id="impl-RefCnt-for-Rc%3CT%3E" class="impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#126-159">source</a><a href="#impl-RefCnt-for-Rc%3CT%3E" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a> for <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;T&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Base-1" class="associatedtype trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#127">source</a><a href="#associatedtype.Base-1" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Base" class="associatedtype">Base</a> = T</h4></section><section id="method.into_ptr" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#128-130">source</a><a href="#method.into_ptr" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.into_ptr" class="fn">into_ptr</a>(me: <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut T</a></h4></section><section id="method.as_ptr" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#131-155">source</a><a href="#method.as_ptr" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.as_ptr" class="fn">as_ptr</a>(me: &amp;<a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut T</a></h4></section><section id="method.from_ptr" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#156-158">source</a><a href="#method.from_ptr" class="anchor">§</a><h4 class="code-header">unsafe fn <a href="#tymethod.from_ptr" class="fn">from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const T</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;T&gt;</h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-RefCnt-for-Arc%3CT%3E" class="impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#91-124">source</a><a href="#impl-RefCnt-for-Arc%3CT%3E" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a> for <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Base-2" class="associatedtype trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#92">source</a><a href="#associatedtype.Base-2" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Base" class="associatedtype">Base</a> = T</h4></section><section id="method.into_ptr-1" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#93-95">source</a><a href="#method.into_ptr-1" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.into_ptr" class="fn">into_ptr</a>(me: <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut T</a></h4></section><section id="method.as_ptr-1" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#96-120">source</a><a href="#method.as_ptr-1" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.as_ptr" class="fn">as_ptr</a>(me: &amp;<a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut T</a></h4></section><section id="method.from_ptr-1" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#121-123">source</a><a href="#method.from_ptr-1" class="anchor">§</a><h4 class="code-header">unsafe fn <a href="#tymethod.from_ptr" class="fn">from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const T</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt;</h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-RefCnt-for-Option%3CT%3E" class="impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#161-176">source</a><a href="#impl-RefCnt-for-Option%3CT%3E" class="anchor">§</a><h3 class="code-header">impl&lt;T: <a class="trait" href="trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a>&gt; <a class="trait" href="trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a> for <a class="enum" href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Base-3" class="associatedtype trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#162">source</a><a href="#associatedtype.Base-3" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Base" class="associatedtype">Base</a> = &lt;T as <a class="trait" href="trait.RefCnt.html" title="trait arc_swap::RefCnt">RefCnt</a>&gt;::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></h4></section><section id="method.into_ptr-2" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#163-165">source</a><a href="#method.into_ptr-2" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.into_ptr" class="fn">into_ptr</a>(me: <a class="enum" href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>T::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></h4></section><section id="method.as_ptr-2" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#166-168">source</a><a href="#method.as_ptr-2" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.as_ptr" class="fn">as_ptr</a>(me: &amp;<a class="enum" href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*mut </a>T::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a></h4></section><section id="method.from_ptr-2" class="method trait-impl"><a class="src rightside" href="../src/arc_swap/ref_cnt.rs.html#169-175">source</a><a href="#method.from_ptr-2" class="anchor">§</a><h4 class="code-header">unsafe fn <a href="#tymethod.from_ptr" class="fn">from_ptr</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.pointer.html">*const </a>T::<a class="associatedtype" href="trait.RefCnt.html#associatedtype.Base" title="type arc_swap::RefCnt::Base">Base</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;T&gt;</h4></section></div></details><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../trait.impl/arc_swap/ref_cnt/trait.RefCnt.js" data-ignore-extern-crates="alloc,core" async></script></section></div></main></body></html>