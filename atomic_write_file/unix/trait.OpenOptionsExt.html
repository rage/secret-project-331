<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Unix-specific extensions to `OpenOptions`."><title>OpenOptionsExt in atomic_write_file::unix - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-ac92e1bbe349e143.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="atomic_write_file" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0 (07dca489a 2024-02-04)" data-channel="1.76.0" data-search-js="search-2b6ce74ff89ae146.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-f2adc0d6ca4d09fb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-305769736d49e732.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-feafe1bb7466e4bd.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../atomic_write_file/index.html">atomic_write_file</a><span class="version">0.1.3</span></h2></div><h2 class="location"><a href="#">OpenOptionsExt</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.preserve_mode">preserve_mode</a></li><li><a href="#tymethod.preserve_owner">preserve_owner</a></li><li><a href="#tymethod.try_preserve_owner">try_preserve_owner</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In atomic_write_file::unix</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../atomic_write_file/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">atomic_write_file</a>::<wbr><a href="index.html">unix</a>::<wbr><a class="trait" href="#">OpenOptionsExt</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/atomic_write_file/unix.rs.html#43-164">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait OpenOptionsExt {
    // Required methods
    fn <a href="#tymethod.preserve_mode" class="fn">preserve_mode</a>(&amp;mut self, preserve_mode: <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.bool.html">bool</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.reference.html">&amp;mut Self</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.preserve_owner" class="fn">preserve_owner</a>(&amp;mut self, preserve_owner: <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.bool.html">bool</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.reference.html">&amp;mut Self</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.try_preserve_owner" class="fn">try_preserve_owner</a>(&amp;mut self, try_preserve_owner: <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.bool.html">bool</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.reference.html">&amp;mut Self</a>;
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Unix-specific extensions to <a href="../struct.OpenOptions.html" title="struct atomic_write_file::OpenOptions"><code>OpenOptions</code></a>.</p>
<p>On Unix, <a href="../struct.AtomicWriteFile.html" title="struct atomic_write_file::AtomicWriteFile"><code>AtomicWriteFile</code></a> works by creating a temporary file, and then renaming the file to
its final name at commit time. If a file with the same name already exists, it is often
desiderable that the new file written by <a href="../struct.AtomicWriteFile.html" title="struct atomic_write_file::AtomicWriteFile"><code>AtomicWriteFile</code></a> preserves the same permissions,
attributes, and other metadata as the original file. This extension trait allows you to control
which metadata should be preserved, and which metadata should use default values instead.</p>
<p><strong>Note:</strong> <a href="../struct.AtomicWriteFile.html" title="struct atomic_write_file::AtomicWriteFile"><code>AtomicWriteFile</code></a> samples and copies the metadata from the original file (if any)
to the temporary file when the <a href="../struct.AtomicWriteFile.html" title="struct atomic_write_file::AtomicWriteFile"><code>AtomicWriteFile</code></a> is initially opened. If the original file
metadata is changed, or the original file is deleted, or the original file gets (re-)created,
before the <a href="../struct.AtomicWriteFile.html" title="struct atomic_write_file::AtomicWriteFile"><code>AtomicWriteFile</code></a> is committed, those changes won’t be reflected in the final
result.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.preserve_mode" class="method"><a class="src rightside" href="../../src/atomic_write_file/unix.rs.html#74">source</a><h4 class="code-header">fn <a href="#tymethod.preserve_mode" class="fn">preserve_mode</a>(&amp;mut self, preserve_mode: <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.bool.html">bool</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.reference.html">&amp;mut Self</a></h4></section></summary><div class="docblock"><p>Specifies whether the atomically-written file should have the file permissions of the
original file (if any).</p>
<p>If <code>true</code> (the default), the file permissions of the original file (if any) are copied over
to the atomically-written file when <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> is called.</p>
<p>If <code>false</code>, or if no original file exists when <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> is called, the
default mode <code>0o666</code> is used, which will be masked with the process umask. The default mask
can be customized using <a href="https://doc.rust-lang.org/1.76.0/std/os/unix/fs/trait.OpenOptionsExt.html#tymethod.mode" title="method std::os::unix::fs::OpenOptionsExt::mode"><code>std::os::unix::fs::OpenOptionsExt::mode()</code></a>.</p>
<p>This method only preserves the permissions that can be set through <code>chmod(2)</code>. This method
has no effect on ACLs (POSIX Access Control Lists).</p>
<h5 id="examples"><a href="#examples">Examples</a></h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>atomic_write_file::OpenOptions;
<span class="kw">use </span>atomic_write_file::unix::OpenOptionsExt;

<span class="kw">let </span><span class="kw-2">mut </span>options = OpenOptions::new();
options.preserve_mode(<span class="bool-val">false</span>);
<span class="kw">let </span>file = options.open(<span class="string">"foo.txt"</span>)<span class="question-mark">?</span>;
file.commit()<span class="question-mark">?</span>; <span class="comment">// "foo.txt" is saved with the default mode</span></code></pre></div>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.preserve_owner" class="method"><a class="src rightside" href="../../src/atomic_write_file/unix.rs.html#118">source</a><h4 class="code-header">fn <a href="#tymethod.preserve_owner" class="fn">preserve_owner</a>(&amp;mut self, preserve_owner: <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.bool.html">bool</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.reference.html">&amp;mut Self</a></h4></section></summary><div class="docblock"><p>Specifies whether the atomically-written file should have the same ownership (user/group)
of the original file (if any).</p>
<p>If <code>true</code>, the ownership of the original file (if any) is copied over
to the atomically-written file when <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> is called.</p>
<p>If <code>false</code>, or if no original file exists when <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> is called, the
ownership is set using the default platform-specific semantics.</p>
<p><strong>Note:</strong> setting ownership of files generally requires root privileges on Unix platforms
(or <code>CAP_CHOWN</code> on Linux). As such, using <code>preserve_owner(true)</code> when the process is not
running as root may result in <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> to fail with an error.</p>
<p>The related method <a href="trait.OpenOptionsExt.html#tymethod.try_preserve_owner" title="method atomic_write_file::unix::OpenOptionsExt::try_preserve_owner"><code>OpenOptionsExt::try_preserve_owner()</code></a> allows to preserve ownership
only if the process has sufficient privileges. It is a variant of this option that does not
cause <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> to fail when the process does not have enough privileges to
preserve ownership.</p>
<p>By default, <code>try_preserve_owner(true)</code> is used.</p>
<p>Calling <code>preserve_owner()</code> overrides any previous call to <code>preserve_owner()</code> or
<code>try_preserve_owner()</code>.</p>
<h5 id="examples-1"><a href="#examples-1">Examples</a></h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>atomic_write_file::OpenOptions;
<span class="kw">use </span>atomic_write_file::unix::OpenOptionsExt;

<span class="kw">let </span><span class="kw-2">mut </span>options = OpenOptions::new();
options.preserve_owner(<span class="bool-val">true</span>);
<span class="kw">let </span>file = options.open(<span class="string">"foo.txt"</span>)<span class="question-mark">?</span>; <span class="comment">// this fails if "foo.txt" exists and its ownership
                                     // cannot be preserved
</span>file.commit()<span class="question-mark">?</span>; <span class="comment">// "foo.txt" is saved with the same ownership as the original "foo.txt"
                // (if any)</span></code></pre></div>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.try_preserve_owner" class="method"><a class="src rightside" href="../../src/atomic_write_file/unix.rs.html#163">source</a><h4 class="code-header">fn <a href="#tymethod.try_preserve_owner" class="fn">try_preserve_owner</a>(&amp;mut self, try_preserve_owner: <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.bool.html">bool</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.76.0/std/primitive.reference.html">&amp;mut Self</a></h4></section></summary><div class="docblock"><p>Specifies whether the atomically-written file should have the ownership information
(user/group) of the original file (if any). If ownership information cannot be set on the
atomically-written file, and if the process is not running as root, then
<a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> silently continues suppressing the error.</p>
<p>Using <code>try_preserve_owner(true)</code> is equivalent to using
<a href="trait.OpenOptionsExt.html#tymethod.preserve_owner" title="method atomic_write_file::unix::OpenOptionsExt::preserve_owner"><code>OpenOptionsExt::preserve_owner(true)</code></a>, with the
exception that this option does not cause <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> to fail with a “Operation
not permitted” (<code>EPERM</code>) error if the process is not running as root (effective UID 0).</p>
<p>Note that <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> may still fail with an error when setting ownership if an
error other than “Operation not permitted” (<code>EPERM</code>) is thrown.</p>
<p>If the process is running as root, then all errors are reported by <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a>.</p>
<p>If <code>false</code>, or if no original file exists when <a href="../struct.OpenOptions.html#method.open" title="method atomic_write_file::OpenOptions::open"><code>OpenOptions::open()</code></a> is called, the
ownership is set using the default platform-specific semantics.</p>
<p>The default value for this option is <code>true</code>.</p>
<p>Calling <code>try_preserve_owner()</code> overrides any previous call to <code>preserve_owner()</code> or
<code>try_preserve_owner()</code>.</p>
<h5 id="examples-2"><a href="#examples-2">Examples</a></h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>atomic_write_file::OpenOptions;
<span class="kw">use </span>atomic_write_file::unix::OpenOptionsExt;

<span class="kw">let </span><span class="kw-2">mut </span>options = OpenOptions::new();
options.try_preserve_owner(<span class="bool-val">true</span>); <span class="comment">// this is the default
</span><span class="kw">let </span>file = options.open(<span class="string">"foo.txt"</span>)<span class="question-mark">?</span>; <span class="comment">// this won't fail if "foo.txt" exists, its ownership
                                     // cannot be preserved, and the process is not running
                                     // as root
</span>file.commit()<span class="question-mark">?</span>; <span class="comment">// "foo.txt" is saved with the same ownership as the original "foo.txt"
                // (if any)</span></code></pre></div>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/1.76.0/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-OpenOptionsExt-for-OpenOptions" class="impl"><a class="src rightside" href="../../src/atomic_write_file/unix.rs.html#166-190">source</a><a href="#impl-OpenOptionsExt-for-OpenOptions" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.OpenOptionsExt.html" title="trait atomic_write_file::unix::OpenOptionsExt">OpenOptionsExt</a> for <a class="struct" href="../struct.OpenOptions.html" title="struct atomic_write_file::OpenOptions">OpenOptions</a></h3></section></div><script src="../../trait.impl/atomic_write_file/unix/trait.OpenOptionsExt.js" async></script></section></div></main></body></html>