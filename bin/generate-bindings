#!/bin/bash
set -euo pipefail
source "$(dirname "$0")/.common"

BASEDIR="$(dirname "${BASH_SOURCE[0]}")"

# Generate types

FOLDER_PATH="$BASEDIR/../services/headless-lms/"
RELATIVE_PATH=$(realpath --relative-to="$(pwd)" "$FOLDER_PATH")

run_command cd "$RELATIVE_PATH" || exit

run_command cargo test --lib ts_binding_generator

# Fix formatting
run_command sed -i '1s;^;// ###########################################\n// ## This file is autogenerated by running ## \n// ## "bin/generate-bindings" in the root   ##\n// ## folder of this repo                   ##\n// ##                                       ##\n// ## Do not edit this file by hand.        ##\n// ###########################################\n\n;' ../../shared-module/src/bindings.ts

run_command npm run eslint:format-bindings

# Post-update for shared module

run_command npm run postinstall
