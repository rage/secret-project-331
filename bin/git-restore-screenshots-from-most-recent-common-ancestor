#!/bin/bash
set -euo pipefail
source "$(dirname "$0")/.common"

BASEDIR="$(dirname "${BASH_SOURCE[0]}")"
FOLDER_PATH="$BASEDIR/../system-tests/src/tests"
RELATIVE_PATH=$(realpath --relative-to="$(pwd)" "$FOLDER_PATH")

echo -e "${BLUE}Will restore the screenshots from the most recent common ancestor between your branch and origin/master."
echo "This will undo any accidentally overwritten screenshot changes while making sure you won't get a screenshot that is newer than the code on your branch."
echo "To get the lastest screenshots, please run bin/git-merge-origin-master before this one."
echo -e "$RESET_EVERYTHING"

run_command git fetch origin

CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
MOST_RECENT_COMMON_ANCESTOR="$(git merge-base "$CURRENT_BRANCH" origin/master)"

echo "> git ls-files \"$RELATIVE_PATH\" | grep '.png' | xargs git restore --source \"$MOST_RECENT_COMMON_ANCESTOR\""
run_command git ls-files "$RELATIVE_PATH" | grep '.png' | xargs git restore --source "$MOST_RECENT_COMMON_ANCESTOR"

