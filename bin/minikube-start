#!/bin/bash
set -euo pipefail
source "$(dirname "$0")/.common"

ensure_program_in_path "minikube"
check_minikube_version

COMMAND="minikube"
cores=$(nproc)

if [[ "$OSTYPE" == "cygwin" || "$OSTYPE" == "msys" || "$OSTYPE" == "win32" ]]; then
  echo "ðŸªŸ  Detected Windows with $cores available cores."
  ARGUMENTS=(start --vm-driver=virtualbox --addons ingress --cpus "$cores" --disk-size 100g "$@")
elif [[ "$OSTYPE" == "darwin"* ]]; then
  echo "ðŸŽ Detected macOS with $cores available cores."
  ARGUMENTS=(start --addons ingress --cpus "$cores" --disk-size 100g "$@")
else
  echo "ðŸ§ Detected Linux with $cores available cores."
  ARGUMENTS=(start --addons ingress --cpus "$cores" --disk-size 100g "$@")
fi

echo "> $COMMAND" "$(printf "%q " "${ARGUMENTS[@]}")"
exec "$COMMAND" "${ARGUMENTS[@]}"
