<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Defines the behavior and return values of rate limiting decisions."><meta name="keywords" content="rust, rustlang, rust-lang, RateLimitingMiddleware"><title>RateLimitingMiddleware in governor::middleware - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../governor/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../governor/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">RateLimitingMiddleware</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#associated-types">Associated Types</a></h3><ul><li><a href="#associatedtype.NegativeOutcome">NegativeOutcome</a></li><li><a href="#associatedtype.PositiveOutcome">PositiveOutcome</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.allow">allow</a></li><li><a href="#tymethod.disallow">disallow</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In governor::middleware</a></h2><div id="sidebar-vars" data-name="RateLimitingMiddleware" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../governor/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="../index.html">governor</a>::<wbr><a href="index.html">middleware</a>::<wbr><a class="trait" href="#">RateLimitingMiddleware</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/governor/middleware.rs.html#165-208">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait RateLimitingMiddleware&lt;P:&nbsp;<a class="trait" href="../clock/trait.Reference.html" title="trait governor::clock::Reference">Reference</a>&gt;: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> {
    type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>;
    type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>;
    fn <a href="#tymethod.allow" class="fnname">allow</a>&lt;K&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key: <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.reference.html">&amp;</a>K, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state: impl <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.PositiveOutcome" title="type governor::middleware::RateLimitingMiddleware::PositiveOutcome">PositiveOutcome</a>;
<div class="item-spacer"></div>    fn <a href="#tymethod.disallow" class="fnname">disallow</a>&lt;K&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key: <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.reference.html">&amp;</a>K, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;limiter: impl <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_time: P<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.NegativeOutcome" title="type governor::middleware::RateLimitingMiddleware::NegativeOutcome">NegativeOutcome</a>;
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Defines the behavior and return values of rate limiting decisions.</p>
<p>While the rate limiter defines whether a decision is positive, the
middleware defines what additional values (other than <code>Ok</code> or <code>Err</code>)
are returned from the <a href="../struct.RateLimiter.html" title="crate::RateLimiter"><code>RateLimiter</code></a>’s check methods.</p>
<p>The default middleware in this crate is <a href="struct.NoOpMiddleware.html" title="NoOpMiddleware"><code>NoOpMiddleware</code></a> (which does
nothing in the positive case and returns <a href="../struct.NotUntil.html" title="NotUntil"><code>NotUntil</code></a> in the
negative) - so it does only the smallest amount of work it needs to do
in order to be useful to users.</p>
<p>Other middleware gets to adjust these trade-offs: The pre-made
<a href="struct.StateInformationMiddleware.html" title="StateInformationMiddleware"><code>StateInformationMiddleware</code></a> returns quota and burst capacity
information, while custom middleware could return a set of HTTP
headers or increment counters per each rate limiter key’s decision.</p>
<h2 id="defining-your-own-middleware"><a href="#defining-your-own-middleware">Defining your own middleware</a></h2>
<p>Here’s an example of a rate limiting middleware that does no
computations at all on positive and negative outcomes: All the
information that a caller will receive is that a request should be
allowed or disallowed. This can allow for faster negative outcome
handling, and is useful if you don’t need to tell users when they
can try again (or anything at all about their rate limiting
status).</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">governor</span>::{<span class="ident">middleware</span>::{<span class="ident">RateLimitingMiddleware</span>, <span class="ident">StateSnapshot</span>},
               <span class="ident">Quota</span>, <span class="ident">RateLimiter</span>, <span class="ident">clock::Reference</span>};
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">NullMiddleware</span>;

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">P</span>: <span class="ident">Reference</span><span class="op">&gt;</span> <span class="ident">RateLimitingMiddleware</span><span class="op">&lt;</span><span class="ident">P</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">NullMiddleware</span> {
    <span class="kw">type</span> <span class="ident">PositiveOutcome</span> <span class="op">=</span> ();
    <span class="kw">type</span> <span class="ident">NegativeOutcome</span> <span class="op">=</span> ();

    <span class="kw">fn</span> <span class="ident">allow</span><span class="op">&lt;</span><span class="ident">K</span><span class="op">&gt;</span>(<span class="ident">_key</span>: <span class="kw-2">&amp;</span><span class="ident">K</span>, <span class="ident">_state</span>: <span class="kw">impl</span> <span class="ident">Into</span><span class="op">&lt;</span><span class="ident">StateSnapshot</span><span class="op">&gt;</span>) -&gt; <span class="ident"><span class="self">Self</span>::PositiveOutcome</span> {}
    <span class="kw">fn</span> <span class="ident">disallow</span><span class="op">&lt;</span><span class="ident">K</span><span class="op">&gt;</span>(<span class="kw">_</span>: <span class="kw-2">&amp;</span><span class="ident">K</span>, <span class="kw">_</span>: <span class="kw">impl</span> <span class="ident">Into</span><span class="op">&lt;</span><span class="ident">StateSnapshot</span><span class="op">&gt;</span>, <span class="kw">_</span>: <span class="ident">P</span>) -&gt; <span class="ident"><span class="self">Self</span>::NegativeOutcome</span> {}
}

<span class="kw">let</span> <span class="ident">lim</span> <span class="op">=</span> <span class="ident">RateLimiter::direct</span>(<span class="ident">Quota::per_hour</span>(<span class="macro">nonzero!</span>(<span class="number">1_u32</span>)))
    .<span class="ident">with_middleware</span>::<span class="op">&lt;</span><span class="ident">NullMiddleware</span><span class="op">&gt;</span>();

<span class="macro">assert_eq!</span>(<span class="ident">lim</span>.<span class="ident">check</span>(), <span class="prelude-val">Ok</span>(()));
<span class="macro">assert_eq!</span>(<span class="ident">lim</span>.<span class="ident">check</span>(), <span class="prelude-val">Err</span>(()));</code></pre></div>
</div></details><h2 id="associated-types" class="small-section-header">Associated Types<a href="#associated-types" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="associatedtype.PositiveOutcome" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/governor/middleware.rs.html#174">source</a></div><h4 class="code-header">type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></h4></div></summary><div class="docblock"><p>The type that’s returned by the rate limiter when a cell is allowed.</p>
<p>By default, rate limiters return <code>Ok(())</code>, which does not give
much information. By using custom middleware, users can obtain
more information about the rate limiter state that was used to
come to a decision. That state can then be used to pass
information downstream about, e.g. how much burst capacity is
remaining.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="associatedtype.NegativeOutcome" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/governor/middleware.rs.html#181">source</a></div><h4 class="code-header">type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></h4></div></summary><div class="docblock"><p>The type that’s returned by the rate limiter when a cell is <em>not</em> allowed.</p>
<p>By default, rate limiters return <code>Err(NotUntil)</code>, which
allows interrogating the minimum amount of time to wait until
a client can expect to have a cell allowed again.</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.allow" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/governor/middleware.rs.html#195">source</a></div><h4 class="code-header">fn <a href="#tymethod.allow" class="fnname">allow</a>&lt;K&gt;(key: <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.reference.html">&amp;</a>K, state: impl <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.PositiveOutcome" title="type governor::middleware::RateLimitingMiddleware::PositiveOutcome">PositiveOutcome</a></h4></div></summary><div class="docblock"><p>Called when a positive rate-limiting decision is made.</p>
<p>This function is able to affect the return type of
<a href="../struct.RateLimiter.html#method.check">RateLimiter.check</a>
(and others) in the Ok case: Whatever is returned here is the
value of the Ok result returned from the check functions.</p>
<p>The function is passed a snapshot of the rate-limiting state
updated to <em>after</em> the decision was reached: E.g., if there
was one cell left in the burst capacity before the decision
was reached, the <a href="struct.StateSnapshot.html#method.remaining_burst_capacity" title="StateSnapshot::remaining_burst_capacity"><code>StateSnapshot::remaining_burst_capacity</code></a>
method will return 0.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.disallow" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/governor/middleware.rs.html#203-207">source</a></div><h4 class="code-header">fn <a href="#tymethod.disallow" class="fnname">disallow</a>&lt;K&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;key: <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.reference.html">&amp;</a>K, <br>&nbsp;&nbsp;&nbsp;&nbsp;limiter: impl <a class="trait" href="https://doc.rust-lang.org/1.60.0/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;start_time: P<br>) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.NegativeOutcome" title="type governor::middleware::RateLimitingMiddleware::NegativeOutcome">NegativeOutcome</a></h4></div></summary><div class="docblock"><p>Called when a negative rate-limiting decision is made (the
“not allowed but OK” case).</p>
<p>This method returns whatever value is returned inside the
<code>Err</code> variant a <a href="../struct.RateLimiter.html" title="crate::RateLimiter"><code>RateLimiter</code></a>’s check
method returns.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-RateLimitingMiddleware%3CP%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/governor/middleware.rs.html#216-236">source</a></span><a href="#impl-RateLimitingMiddleware%3CP%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;P:&nbsp;<a class="trait" href="../clock/trait.Reference.html" title="trait governor::clock::Reference">Reference</a>&gt; <a class="trait" href="trait.RateLimitingMiddleware.html" title="trait governor::middleware::RateLimitingMiddleware">RateLimitingMiddleware</a>&lt;P&gt; for <a class="struct" href="struct.NoOpMiddleware.html" title="struct governor::middleware::NoOpMiddleware">NoOpMiddleware</a>&lt;P&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.PositiveOutcome-1" class="type trait-impl has-srclink"><a href="#associatedtype.PositiveOutcome-1" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a> = <a class="primitive" href="https://doc.rust-lang.org/1.60.0/std/primitive.unit.html">()</a></h4></section><section id="associatedtype.NegativeOutcome-1" class="type trait-impl has-srclink"><a href="#associatedtype.NegativeOutcome-1" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a> = <a class="struct" href="../struct.NotUntil.html" title="struct governor::NotUntil">NotUntil</a>&lt;P&gt;</h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-RateLimitingMiddleware%3CP%3E-1" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/governor/middleware.rs.html#243-260">source</a></span><a href="#impl-RateLimitingMiddleware%3CP%3E-1" class="anchor"></a><h3 class="code-header in-band">impl&lt;P:&nbsp;<a class="trait" href="../clock/trait.Reference.html" title="trait governor::clock::Reference">Reference</a>&gt; <a class="trait" href="trait.RateLimitingMiddleware.html" title="trait governor::middleware::RateLimitingMiddleware">RateLimitingMiddleware</a>&lt;P&gt; for <a class="struct" href="struct.StateInformationMiddleware.html" title="struct governor::middleware::StateInformationMiddleware">StateInformationMiddleware</a></h3></section></summary><div class="impl-items"><section id="associatedtype.PositiveOutcome-2" class="type trait-impl has-srclink"><a href="#associatedtype.PositiveOutcome-2" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a> = <a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a></h4></section><section id="associatedtype.NegativeOutcome-2" class="type trait-impl has-srclink"><a href="#associatedtype.NegativeOutcome-2" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a> = <a class="struct" href="../struct.NotUntil.html" title="struct governor::NotUntil">NotUntil</a>&lt;P&gt;</h4></section></div></details></div><script type="text/javascript" src="../../implementors/governor/middleware/trait.RateLimitingMiddleware.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="governor" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0 (7737e0b5c 2022-04-04)" ></div>
</body></html>