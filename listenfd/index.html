<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="listenfd is a crate that provides support for working with externally managed and passed file descriptors.  This lets you work with systems that support socket activation or similar."><meta name="keywords" content="rust, rustlang, rust-lang, listenfd"><title>listenfd - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../listenfd/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate listenfd</p><div class="block version"><p>Version 0.3.3</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all listenfd's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="listenfd" data-ty="mod" data-relpath="../"></div></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">listenfd</a></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/listenfd/lib.rs.html#1-69" title="goto source code">[src]</a></span></h1><div class="docblock"><p>listenfd is a crate that provides support for working with externally
managed and passed file descriptors.  This lets you work with systems
that support socket activation or similar.</p>
<p>Currently this supports a slightly modified systemd protocl on unix and
a custom protocol on Windows.  If you want to use this for development
you can use the <a href="https://github.com/mitsuhiko/systemfd">systemfd</a>
utility which implements both those protocols.</p>
<p>The systemd extension is that if the <code>LISTEN_PID</code> variable is not set or
empty, the check for the pid is removed.  This is useful when binaries
are proxied in between like cargo-watch.  For the windows protocol
have a look at the systemfd documentation.</p>
<h2 id="example" class="section-header"><a href="#example">Example</a></h2>
<p>This example shows how to use this crate with an <code>actix-web</code> server:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">listenfd</span>::<span class="ident">ListenFd</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">listenfd</span> <span class="op">=</span> <span class="ident">ListenFd</span>::<span class="ident">from_env</span>();
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">server</span> <span class="op">=</span> <span class="ident">make_a_server</span>();

<span class="comment">// if we are given a tcp listener on listen fd 0, we use that one</span>
<span class="ident">server</span> <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>(<span class="ident">listener</span>) <span class="op">=</span> <span class="ident">listenfd</span>.<span class="ident">take_tcp_listener</span>(<span class="number">0</span>)<span class="question-mark">?</span> {
    <span class="ident">server</span>.<span class="ident">listen</span>(<span class="ident">listener</span>)
<span class="comment">// otherwise fall back to local listening</span>
} <span class="kw">else</span> {
    <span class="ident">server</span>.<span class="ident">bind</span>(<span class="string">&quot;127.0.0.1:3000&quot;</span>)<span class="question-mark">?</span>
};</pre></div>
<p>You can then use this with cargo watch and systemfd:</p>
<pre><code class="language-plain">$ cargo install systemfd cargo-watch
systemfd --no-pid -s 3000 -- cargo watch -x run
</code></pre>
<p>Now systemfd will open the socket and keep it open.  cargo watch will
recompile the code on demand and the server will pick up the socket
that systemfd opened.  No more connection resets.</p>
<p>The <code>--no-pid</code> flag is necessary to ensure that the <code>LISTEN_PID</code> environment
variable is not set or the socket passing will be prevented by the pid check.</p>
</div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.ListenFd.html" title="listenfd::ListenFd struct">ListenFd</a></td><td class="docblock-short"><p>A helper object that gives access to raw file descriptors.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="listenfd" data-search-js="../search-index.js"></div>
    <script src="../main.js"></script></body></html>