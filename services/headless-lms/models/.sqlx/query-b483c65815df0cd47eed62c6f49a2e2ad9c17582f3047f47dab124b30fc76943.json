{
  "db_name": "PostgreSQL",
  "query": "\nWITH enrolled AS (\n  SELECT DISTINCT user_id\n  FROM course_instance_enrollments\n  WHERE course_id = $1\n    AND deleted_at IS NULL\n),\nuser_certs AS (\n  SELECT\n    gc.user_id,\n    MAX(gc.created_at) AS latest_issued_at\n  FROM generated_certificates gc\n  JOIN certificate_configuration_to_requirements cctr\n    ON gc.certificate_configuration_id = cctr.certificate_configuration_id\n   AND cctr.deleted_at IS NULL\n  JOIN course_modules cm\n    ON cm.id = cctr.course_module_id\n   AND cm.deleted_at IS NULL\n  WHERE cm.course_id = $1\n    AND gc.deleted_at IS NULL\n  GROUP BY gc.user_id\n)\nSELECT\n  /* non-null */\n  CASE\n    WHEN ud.first_name IS NULL OR TRIM(ud.first_name) = ''\n      OR ud.last_name  IS NULL OR TRIM(ud.last_name)  = ''\n    THEN '(Missing name)'\n    ELSE TRIM(ud.first_name) || ' ' || TRIM(ud.last_name)\n  END AS \"student!\",\n  /* non-null */\n  CASE\n    WHEN uc.user_id IS NOT NULL THEN 'Course Certificate'\n    ELSE 'No Certificate'\n  END AS \"certificate!\",\n  /* nullable */\n  uc.latest_issued_at AS \"date_issued?\"\nFROM enrolled e\nJOIN users u ON u.id = e.user_id\nLEFT JOIN user_details ud ON ud.user_id = u.id\nLEFT JOIN user_certs uc ON uc.user_id = e.user_id\nORDER BY\n  COALESCE(NULLIF(LOWER(TRIM(ud.last_name)),  ''), 'zzzzzz'),\n  COALESCE(NULLIF(LOWER(TRIM(ud.first_name)), ''), 'zzzzzz')\n        ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "student!",
        "type_info": "Text"
      },
      {
        "ordinal": 1,
        "name": "certificate!",
        "type_info": "Text"
      },
      {
        "ordinal": 2,
        "name": "date_issued?",
        "type_info": "Timestamptz"
      }
    ],
    "parameters": {
      "Left": [
        "Uuid"
      ]
    },
    "nullable": [
      null,
      null,
      null
    ]
  },
  "hash": "b483c65815df0cd47eed62c6f49a2e2ad9c17582f3047f47dab124b30fc76943"
}
