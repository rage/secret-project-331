<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Visitor generator for the rust language."><meta name="keywords" content="rust, rustlang, rust-lang, swc_visit"><title>swc_visit - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../swc_visit/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate swc_visit</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.2.6</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all swc_visit's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></div><div id="sidebar-vars" data-name="swc_visit" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">swc_visit</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/swc_visit/lib.rs.html#1-189" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Visitor generator for the rust language.</p>
<p>There are three variants of visitor in swc. Those are <code>Fold</code>, <code>VisitMut</code>,
<code>Visit</code>.</p>
<h1 id="comparisons" class="section-header"><a href="#comparisons">Comparisons</a></h1><h2 id="fold-vs-visitmut" class="section-header"><a href="#fold-vs-visitmut"><code>Fold</code> vs <code>VisitMut</code></a></h2>
<p><code>Fold</code> and <code>VisitMut</code> do almost identical tasks, but <code>Fold</code> is easier to use
while being slower and weak to stack overflow for very deep asts. <code>Fold</code> is
fast enough for almost all cases so it would be better to start with <code>Fold</code>.</p>
<p>By very deep asts, I meant code like thousands of <code>a + a + a + a + ...</code>.</p>
<h1 id="fold" class="section-header"><a href="#fold"><code>Fold</code></a></h1>
<p><code>Fold</code> takes ownership of value, which means you have to return the new
value. Returning new value means returning ownership of the value. But you
don’t have to care about ownership or about managing memories while using
such visitors. <code>rustc</code> handles them automatically and all allocations will
be freed when it goes out of the scope.</p>
<p>You can invoke your <code>Fold</code> implementation like <code>node.fold_with(&amp;mut visitor)</code> where <code>visitor</code> is your visitor. Note that as it takes ownership
of value, you have to call <code>node.fold_children_with(self)</code> in e.g. <code>fn fold_module(&amp;mut self, m: Module) -&gt; Module</code> if you override the default
behavior. Also you have to store return value from <code>fold_children_with</code>,
like <code>let node = node.fold_children_with(self)</code>. Order of execution can be
controlled using this. If there is some logic that should be applied to the
parent first, you can call <code>fold_children_with</code> after such logic.</p>
<h1 id="visitmut" class="section-header"><a href="#visitmut"><code>VisitMut</code></a></h1>
<p><code>VisitMut</code> uses a mutable reference to AST nodes (e.g. <code>&amp;mut Expr</code>). You can
use <code>MapWithMut</code> from <code>swc_ecma_transforms_base</code> to get owned value from a
mutable reference.</p>
<p>You will typically use code like</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="kw-2">*</span><span class="ident">e</span> <span class="op">=</span> <span class="ident">return_value</span>.<span class="ident">take</span>();</code></pre></div>
<p>where <code>e = &amp;mut Expr</code> and <code>return_value</code> is also <code>&amp;mut Expr</code>. <code>take()</code> is an
extension method defined on <code>MapWithMut</code>.  It’s almost identical to <code>Fold</code>,
so I’ll skip memory management.</p>
<p>You can invoke your <code>VisitMut</code> implementation like <code>node.visit_mut_with(&amp;mut visitor)</code> where <code>visitor</code> is your visitor. Again, you need to call
<code>node.visit_mut_children_with(self)</code> in visitor implementation if you want
to modify children nodes. You don’t need to store the return value in this
case.</p>
<h1 id="visit" class="section-header"><a href="#visit"><code>Visit</code></a></h1>
<p><code>Visit</code> uses non-mutable references to AST nodes. It can be used to see if
an AST node contains a specific node nested deeply in the AST. This is
useful for checking if AST node contains <code>this</code>. This is useful for lots of
cases - <code>this</code> in arrow expressions are special and we need to generate
different code if a <code>this</code> expression is used.</p>
<p>You can use your <code>Visit</code> implementation like  <code>node.visit_with(&amp;Invalid{ span: DUMY_SP, }, &amp;mut visitor</code>. I think API is misdesigned, but it works
and there are really lots of code using <code>Visit</code> already.</p>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="mod" href="util/index.html" title="swc_visit::util mod">util</a></div><div class="item-right docblock-short"><p>Some utilities for generated visitors.</p>
</div></div><h2 id="macros" class="section-header"><a href="#macros">Macros</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="macro" href="macro.chain.html" title="swc_visit::chain macro">chain</a></div><div class="item-right docblock-short"><p>Chains multiple visitor.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.define.html" title="swc_visit::define macro">define</a></div><div class="item-right docblock-short"><p>This creates <code>Visit</code>. This is extensible visitor generator, and it</p>
</div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="struct" href="struct.All.html" title="swc_visit::All struct">All</a></div><div class="item-right docblock-short"><p>Visit all children nodes. This converts <code>VisitAll</code> to <code>Visit</code>. The type
parameter <code>V</code> should implement <code>VisitAll</code> and <code>All&lt;V&gt;</code> implements <code>Visit</code>.</p>
</div><div class="item-left module-item"><a class="struct" href="struct.AndThen.html" title="swc_visit::AndThen struct">AndThen</a></div><div class="item-right docblock-short"><p>A visitor which applies <code>A</code> and then <code>B</code>.</p>
</div><div class="item-left module-item"><a class="struct" href="struct.Optional.html" title="swc_visit::Optional struct">Optional</a></div><div class="item-right docblock-short"><p>A visitor which visits node only if <code>enabled</code> is true.</p>
</div><div class="item-left module-item"><a class="struct" href="struct.Repeat.html" title="swc_visit::Repeat struct">Repeat</a></div><div class="item-right docblock-short"><p>A visitor which applies <code>V</code> again and again if <code>V</code> modifies the node.</p>
</div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="enum" href="enum.Either.html" title="swc_visit::Either enum">Either</a></div><div class="item-right docblock-short"><p>The enum <code>Either</code> with variants <code>Left</code> and <code>Right</code> is a general purpose
sum type with two cases.</p>
</div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="trait" href="trait.Repeated.html" title="swc_visit::Repeated trait">Repeated</a></div><div class="item-right docblock-short"><p>Trait for a pass which is designed to invoked multiple time to same input.</p>
</div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="swc_visit" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>